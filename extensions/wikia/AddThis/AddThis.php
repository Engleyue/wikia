<?php

/**
 * Adds AddThis functionality to the wiki
 *
 * @author Lucas Garczewski <tor@wikia-inc.com>
 */

$wgHooks['SkinAfterBottomScripts'][] = 'efAddShareThisCode';
$wgHooks['MonacoAfterArticleLinks'][] = 'efAddShareThisButton';
$wgExtensionMessagesFiles['addthis'] = dirname( __FILE__ ) . '/AddThis.i18n.php';

function efAddShareThisCode( $skin, $text ) {
	global $wgTitle;

	// only available under Monaco, on existing, non-special pages
	if ( $skin->getSkinname() !== 'monaco' || !$wgTitle->exists() || $wgTitle->getNamespace() == NS_SPECIAL ) {
		return true;
	}

	// add code generated by AddThis
	$text .= '<script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js?pub=lleowen"></script>
	<script type="text/javascript">
	var addthis_options = "facebook, stumbleupon, twitter, digg, reddit, technorati, blogger, slashdot, n4g, email, more";
	var addthis_exclude = "print";
	</script>';

	// hook must return a value
	return true;
}

function efAddShareThisButton( ) {

	wfLoadExtensionMessages( 'addthis' );

	echo '<li id="control_add">
	<div> </div>
	<a href="http://www.addthis.com/bookmark.php?v=250&pub=lleowen"
	onmouseover="WET.byStr(\'articleAction/addthis\'); return addthis_open(this, \'\', \'[URL]\', \'[TITLE]\');" onmouseout="addthis_close()" onclick="return addthis_sendto()">' .
	wfMsg( 'addthis-link-text' ) . '</a>
	</li>';

	return true;
}
