<html>
<head>
<!-- TODO:
	Speed up page load by looking at blocking calls
	Use Wiki.png instead of Wiki2.png
	Messaging API, swap out hard coded messages calls
	Finish API for "first pages"
	Build out "first pages"
	Implement "Coming Soon" category in starter
	Make "First pages" accessible via a special page
	Add Permission checking to settings changer
	Fix Wiki.png madness
	Error handling for bad images

     Known Bugs:
	Login "sticks" in Safari
	Odd look when the page first loads. Fine after reorg?
	

     Questions:  
	What perms for settings changer?
	What goes on "Done"?
	What happens with first pages after the first time it's created?


AFTER Christian:
	Mediawikify - Put main.html into Mediawiki
	Selenium Test Suite
	Cross Browser testing
-->
<!-- Jquery is required for the API itself -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<!-- Jquery UI is just used for this test page -->
<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.7.2/jquery-ui.min.js"></script>
<!-- Tabs ripped from http://jqueryui.com/demos/tabs/ -->
<link rel="stylesheet" type="text/css" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.7.2/themes/cupertino/jquery-ui.css"/>
<link rel="stylesheet" type="text/css" href="main.css"/>
<style type="text/css">
.ui-tabs .ui-tabs-hide {
         display: none;
}
</style>
<script type="text/javascript">
	$(function() {
		$("#tabs").tabs({
			collapsible: true
		});
	});
</script>
<!-- End tabs setup -->
<script src="../JavascriptAPI/Mediawiki.js"></script>
<script src="main.js"></script>

<script>
// Set up the cookie prefix, which is set in Mediawiki as $wgCookiePrefix
Mediawiki.cookiePrefix = "wikicities";
var match = window.location.search.match(/js_debug=([0-9])/);
if (match !== null){
	Mediawiki.debugLevel = match[1];
}
</script>
</head>
<!-- End Mediawiki API setup -->
<body>

<div id="tabs">
	<ul>
		<li><a href="#tabs-0">0. Logged In?</a></li>
		<li><a href="#tabs-1">1. Add a description</a></li>
		<li><a href="#tabs-2">2. Add a logo</a></li>
		<li><a href="#tabs-3">3. Pick Theme</a></li>
		<li><a href="#tabs-4">4. Create First pages</a></li>
		<li><a href="#tabs-5">5. Done</a></li>
	</ul>

<div id="tabs-0">
        <div id="loginForm">
        <form onSubmit="return NWB.handleLoginForm(this)">
        <label class="formLabel">Username:</label> <input type="text" name="lgname" size="10">
        <label class="formLabel">Password:</label> <input type="password" name="lgpassword" size="10"> <br />
        <input type="submit" value="Login">
        </form>
        </div>

        <div id="logoutForm" style="display:none">
                You are logged in.
                <input type="button" value="logout" onClick="return Mediawiki.logout(NWB.handleLogoutForm)"/>
        </div>

        <script>
        if (Mediawiki.isLoggedIn()){
                $("#loginForm").hide();
                $("#logoutForm").show();
        }
        </script>
</div>


<!-- ##############  Add a description to main page ############## -->
<div id="tabs-1">
	<form onSubmit="return Mediawiki.handleDescriptionForm(this)">
	<div id="desc_form_html">
	Enter a description for the main page:<br />
	<textarea name="desc" rows="10" cols="60" id="desc_textarea"></textarea><br />
	<input type="submit" value="Save Description"/> <br />
	</form>
	</div>

	<script>
	// Setup
	$(function() {
		// Bring in the main page 
		Mediawiki.pullArticleContent(Mediawiki.followRedirect("Main Page"),	
		function (result){ $("#desc_textarea").val(result);},
			{"rvsection":0}
		);
	});
	</script>
</div>

<!-- ############## Add a logo ############ -->
<div id="tabs-2">
	<div id="logo_form_html">
	<!-- Hidden iframe to handle the file upload -->
	<iframe id="hidden_iframe" src="about:blank" style="display:none" name="hidden_iframe" onLoad="NWB.iframeFormUpload(this)"></iframe>
	<form action="/api.php" method="post" enctype="multipart/form-data" target="hidden_iframe" onSubmit='return NWB.iframeFormInit(this)'>
	<input type="hidden" name="action" value="uploadlogo">	
	<input type="hidden" name="format" value="xml">	
	<input id="logo_article" type="hidden" name="title" value="Wiki2.png">	
	Upload a logo<p>
	<input type="file" name="logo_file"><br />
	<p>
	<input type="submit" value="Preview" onClick="this.form.title.value='Wiki-Preview.png'"/> 
	<input type="submit" value="Save" onClick="this.form.title.value='Wiki2.png'"/> 
	</form>
	</div>

	<!-- Christian: help. Float! -->
	<table>
		<tr>
			<td><div id="logo_current"></div></td>
			<td><div id="logo_preview">Logo preview</div></td>
		</tr>
	</table>

	<script> 
	// Fill in the background image for the logo
	$(function() {
		normalizedLogo = Mediawiki.getNormalizedTitle(Mediawiki.$("logo_article").value);
		url = Mediawiki.getImageUrl(normalizedLogo) + '?' + Math.random();
		$("#logo_current").css("backgroundImage", "url(" + url + ")");
	});
	</script>

</div>

<!-- ############## Pick Theme ############## -->

<div id="tabs-3" style="height:300px;">
<style type="text/css">
.theme_selection {
	float: left;
	padding: 15px;
}
</style>
  <div id="theme_chooser">
     Pick a theme
	<p>
    <div id="theme_template" style="display:none" class="theme_selekction">
	<img id="theme_preview_image_$theme" width="100"><br />
	<input onClick="NWB.changeTheme('$theme')" type="radio" name="theme" value="$theme" id="theme_radio_$theme"><label for="theme_radio_$theme">$Theme</label>
    </div>
  </div>

<script>
var wgDefaultTheme = 'slate'; // TODO don't use hardcoded value, use it from Mediawiki

// TODO: Pull this list from wgSkinTheme?
var themes = ['Sapphire', 'Jade', 'Slate', 'Smoke', 'Beach', 'Brick', 'Gaming'];
for (var i = 0; i < themes.length; i++){
	// Copy the template, search and replace the values
	var ltheme = themes[i].toLowerCase();
	var thtml = $("#theme_template").html();
	thtml = thtml.replace(/\$Theme/g, themes[i]);
	thtml = thtml.replace(/\$theme/g, ltheme);


	// Create div with that preview and append it
	// TODO: jQuery this
	var div = document.createElement("div"); 
	div.innerHTML = thtml;
	div.id = "theme_" + themes[i].toLowerCase();
	div.className = "theme_selection";
	Mediawiki.$("theme_chooser").appendChild(div);
	Mediawiki.$("theme_preview_image_" + ltheme).src = "http://images.wikia.com/common/skins/monaco/" + ltheme + "/images/preview.png";


	// Check the box with the current theme ($wgDefaultTheme)
	if (wgDefaultTheme == ltheme) {
		// Check the box and change the theme 
		$("#theme_radio_" + ltheme).attr("checked", true);
		NWB.changeTheme(ltheme);
	}
}
</script>

</div>


<!-- ############## Create first pages ############## -->

<div id="tabs-4" >
	Create your first pages
	<script>
	function addAnotherPage() {
		// TODO, as soon as you get to the last page, it adds another
	}
	</script>
	<form onSubmit="return NWB.handleFirstPages(this)">
	<input type="hidden" name="category_1" value="Coming Soon"><!-- i18n -->
	<div id="all_fp">
	<div class="fp_block" id="category_1">
	Page 1: <input class="fp_page" type="text" name="category_1_page_1"><br />
	Page 2: <input class="fp_page" type="text" name="category_1_page_2"><br />
	Page 3: <input class="fp_page" type="text" name="category_1_page_3"><br />
	</div>

	<p>
	<input type="submit" value="Save (not working yet)">
	</div><!-- all_fp -->
	</form>
</div>
<script>
NWB.handleFirstPages = function(f){

};
</script>

<!-- ############## Create first pages ############## -->

<div id="tabs-5">
	Done. Is this page needed?
</div>

</div> <!-- /div id=tabs -->
