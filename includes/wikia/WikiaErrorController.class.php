<?php

/**
 * Nirvana Framework - Error controller
 *
 * @ingroup nirvana
 *
 * @author Adrian 'ADi' Wieczorek <adi(at)wikia-inc.com>
 * @author Owen Davis <owen(at)wikia-inc.com>
 * @author Wojciech Szela <wojtek(at)wikia-inc.com>
 */
class WikiaErrorController extends WikiaController {

	public function error() {
		$code = $this->getResponse()->getException()->getCode();

		if( empty( $code ) || !$this->isValidHTTPErrorCode( $code ) ) {
			$code = WikiaResponse::RESPONSE_CODE_ERROR;
		}

		$this->getResponse()->setCode( $code );
		$this->getResponse()->setVal('request', $this->request);
		$this->getResponse()->setVal('response', $this->response);
		$this->getResponse()->setVal('devel', $this->app->getGlobal( 'wgDevelEnvironment' ) );
	}

	private function isValidHTTPErrorCode( $code ) {
		return in_array( $code, array( 400, 401, 402, 403, 404, 406, 500, 501, 502, 503 ) );
	}
}
